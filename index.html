<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAI SD</title>

<style>
:root{
    --primary:#2E8B57;
    --danger:#e74c3c;
    --light:#F0FFF0;
    --white:#ffffff;
}
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Segoe UI',sans-serif;
}
body{
    background:var(--light);
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    padding:10px;
}
.app{
    background:var(--white);
    width:100%;
    max-width:750px;
    border-radius:12px;
    box-shadow:0 4px 16px rgba(0,0,0,.15);
    overflow:hidden;
}
header{
    background:var(--primary);
    color:white;
    padding:18px;
    text-align:center;
}
.screen{
    display:none;
    padding:18px;
    min-height:460px;
}
.screen.active{
    display:block;
}
button{
    width:100%;
    padding:10px;
    margin-top:6px;
    border:none;
    border-radius:6px;
    font-weight:bold;
    color:white;
    cursor:pointer;
    background:var(--primary);
}
button.danger{
    background:var(--danger);
}
input,select{
    width:100%;
    padding:8px;
    border:2px solid #ddd;
    border-radius:6px;
    margin-bottom:8px;
}
.option{
    border:2px solid #ccc;
    padding:10px;
    border-radius:6px;
    margin:6px 0;
    cursor:pointer;
}
.option.selected{
    background:var(--primary);
    border-color:var(--primary);
    color:white;
}
.score{
    font-size:2.5rem;
    font-weight:bold;
    text-align:center;
    margin:18px 0;
}
table{
    width:100%;
    border-collapse:collapse;
    font-size:13px;
    margin-top:10px;
}
th,td{
    border:1px solid #ccc;
    padding:4px;
    text-align:center;
}
</style>
</head>
<body>
<div class="app">

<header>
    <h2>PAI SD</h2>
    <p>3A • 3B • 4A • 4B</p>
</header>

<!-- ===================
      LOGIN SCREEN
=================== -->
<div id="login" class="screen active">

    <label>Nama Siswa:</label>
    <input id="inputNama" type="text" placeholder="Masukkan nama">

    <label>Pilih Kelas:</label>
    <select id="inputKelas">
        <option value="">-- Pilih Kelas --</option>
        <option value="3A">Kelas 3A</option>
        <option value="3B">Kelas 3B</option>
        <option value="4A">Kelas 4A</option>
        <option value="4B">Kelas 4B</option>
    </select>

    <small id="loginErr" style="display:none;color:red;"></small>

    <button onclick="mulaiQuiz()">Mulai Quiz</button>
    <button onclick="mulaiUlangan()">Mulai Ulangan CBT</button>
    <button onclick="toggleMusik()">Musik ON/OFF</button>
    <button onclick="openAdmin()">Menu Admin</button>

    <audio id="bgMusic" loop src="ala.mp3"></audio>
</div>

<!-- ===================
      QUIZ SCREEN
=================== -->
<div id="quiz" class="screen">

    <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span id="quizProgress">Soal 1/?</span>
        <span id="quizKelas" style="font-weight:bold;color:var(--primary)"></span>
    </div>

    <div class="question-card">
        <div id="quizTeks"></div>
    </div>

    <div id="quizOpsi"></div>
    <button id="quizNext" onclick="lanjutQuiz()" disabled>Selanjutnya</button>
</div>

<!-- ===================
      QUIZ DONE
=================== -->
<div id="quizDone" class="screen">
    <h3>Quiz Selesai!</h3>
    <h4 id="quizNamaShow"></h4>
    <div id="quizSkor" class="score"></div>
    <button onclick="gotoLogin()">Kembali ke Menu</button>
</div>

<!-- ===================
      ULANGAN SCREEN
=================== -->
<div id="ulangan" class="screen">

    <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span id="ulProg">Soal 1/?</span>
        <span id="ulKelas" style="font-weight:bold;color:var(--primary)"></span>
    </div>

    <div class="question-card">
        <div id="ulTeks"></div>
    </div>

    <div id="ulOpsi"></div>
    <button id="ulNext" onclick="lanjutUlangan()" disabled>Selanjutnya</button>
</div>

<!-- ===================
      ULANGAN DONE
=================== -->
<div id="ulanganDone" class="screen">
    <h3>Ulangan Selesai!</h3>
    <h4 id="ulNamaShow"></h4>
    <div id="ulSkor" class="score"></div>
    <button onclick="gotoLogin()">Kembali ke Menu</button>
</div>

<!-- ===================
        ADMIN
=================== -->
<div id="admin" class="screen">
    <h3>ADMIN PANEL</h3>
    <div id="adminPilihKelas"></div>
    <div id="adminKonten"></div>
    <button onclick="gotoLogin()">Kembali</button>
    <button class="danger" onclick="resetData()">RESET DATA</button>
</div>

</div>
</body>
<script>
/* ===============================
   VAR GLOBAL
===============================*/
let namaSiswa = "";
let kelasSiswa = "";
let soalAktif = [];
let indexSoal = 0;
let nilai = 0;

/* ===============================
   FUNGSI RANDOM SOAL
===============================*/
function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
}

/* ===============================
   SOAL KELAS 3 — RAMADHAN (30)
===============================*/
const soalKelas3 = [
{q:"Bulan Ramadhan adalah bulan diwajibkannya puasa bagi umat Islam. Bulan ini penuh berkah dan ampunan. Bulan tersebut bernama ...",opts:["Syawal","Ramadhan","Rajab","Muharram"],a:1},
{q:"Puasa Ramadhan dilaksanakan mulai terbit fajar hingga terbenam matahari. Kewajiban ini termasuk dalam rukun Islam yang ke ...",opts:["Pertama","Kedua","Ketiga","Keempat"],a:2},
{q:"Di bulan Ramadhan umat Islam memperbanyak membaca Al-Qur'an. Kegiatan ini disebut ...",opts:["Tahlil","Tadarus","Qiroah","Hadrah"],a:1},
{q:"Salah satu keutamaan bulan Ramadhan adalah terdapat malam Lailatul Qadar. Malam tersebut lebih baik dari ...",opts:["Seribu tahun","Seribu bulan","Seratus tahun","Seratus bulan"],a:1},
{q:"Shalat sunnah yang dikerjakan di bulan Ramadhan pada malam hari adalah shalat ...",opts:["Istisqa","Tarawih","Dhuha","Tahajud"],a:1},
{q:"Sebelum berpuasa umat Islam dianjurkan makan sahur. Waktu sahur dilakukan sebelum adzan ...",opts:["Subuh","Dzuhur","Ashar","Maghrib"],a:0},
{q:"Saat berbuka puasa disunnahkan untuk memakan ...",opts:["Kurma","Daging","Ikan","Roti"],a:0},
{q:"Orang yang berhalangan puasa karena sakit atau perjalanan jauh boleh tidak berpuasa dan ...",opts:["Mengganti di hari lain","Tidak perlu ganti","Puasa setengah hari","Tidak sah puasanya"],a:0},
{q:"Zakat yang dikeluarkan pada akhir bulan Ramadhan disebut zakat ...",opts:["Zakat Mal","Zakat Fitrah","Zakat Hewan","Zakat Panen"],a:1},
{q:"Zakat fitrah bertujuan untuk membersihkan orang yang berpuasa dan membantu ...",opts:["Orang kaya","Orang fakir dan miskin","Anak sekolah","Orang musafir"],a:1},
{q:"Hari raya yang dirayakan setelah berpuasa Ramadhan adalah hari raya ...",opts:["Idul Adha","Idul Fitri","Maulid","Isro Mi'raj"],a:1},
{q:"Pada hari raya Idul Fitri umat Islam saling memaafkan untuk mempererat ...",opts:["Permusuhan","Silaturahmi","Permainan","Pertengkaran"],a:1},
{q:"Puasa Ramadhan melatih kita untuk bersabar, menahan amarah, serta meningkatkan rasa ...",opts:["Sombong","Benci","Syukur","Malas"],a:2},
{q:"Anak kecil yang belum baligh tidak diwajibkan berpuasa, namun jika berpuasa termasuk perbuatan ...",opts:["Buruk","Terpuji","Tidak ada manfaat","Dilarang"],a:1},
{q:"Di bulan Ramadhan umat Islam memperbanyak sedekah. Sedekah adalah memberikan sebagian harta kepada ...",opts:["Orang kaya","Orang membutuhkan","Guru","Pedagang"],a:1},
{q:"Puasa Ramadhan dapat membentuk pribadi yang bertakwa. Takwa berarti ...",opts:["Takut pada manusia","Taat kepada Allah","Malas beribadah","Tidak berpuasa"],a:1},
{q:"Saat berpuasa kita dilarang berkata bohong, marah dan bertengkar. Hal ini agar puasa tidak ...",opts:["Sia-sia","Berpahala","Menjadi kuat","Menjadi sehat"],a:0},
{q:"Dalam Al-Qur'an, perintah puasa terdapat dalam surat Al-Baqarah ayat ...",opts:["183","2","5","78"],a:0},
{q:"Nuzulul Qur'an adalah peristiwa ...",opts:["Turunnya Al-Qur'an pertama kali","Hijrah Nabi ke Madinah","Isra Mi'raj","Lahirnya Nabi"],a:0},
{q:"Lailatul Qadar terdapat pada malam-malam ganjil dalam 10 malam terakhir bulan ...",opts:["Syawal","Ramadhan","Muharram","Dzulhijjah"],a:1},
{q:"Puasa Ramadhan bertujuan untuk menjadikan orang yang menjalankannya sebagai ...",opts:["Orang kaya","Orang bertakwa","Orang malas","Orang sombong"],a:1},
{q:"Umat Islam dilarang makan dan minum saat puasa dari ...",opts:["Subuh hingga Maghrib","Zuhur hingga Ashar","Isya hingga Subuh","Maghrib hingga Isya"],a:0},
{q:"Orang yang batal puasa karena sengaja makan atau minum harus ...",opts:["Berpuasa lagi tahun depan","Mengqadha di hari lain","Tidak perlu ganti","Dipaksa berpuasa"],a:1},
{q:"Berbuka puasa sebaiknya tidak berlebihan agar tubuh tetap ...",opts:["Sakit","Sehat","Lemas","Lapar"],a:1},
{q:"Berpuasa dapat melatih kejujuran karena orang berpuasa harus menjaga ...",opts:["Mulut dan Tangan","Perasaan dan Emosi","Lisan dan Perbuatan","Tidur dan Bermain"],a:2},
{q:"Ramadhan adalah bulan turunnya Al-Qur’an. Al-Qur’an diturunkan kepada Nabi ...",opts:["Ibrahim","Musa","Isa","Muhammad"],a:3},
{q:"Setelah bulan Ramadhan umat Islam memasuki bulan ...",opts:["Syawal","Rajab","Muharram","Safar"],a:0},
{q:"Niat puasa Ramadhan dilakukan sebelum masuk waktu ...",opts:["Subuh","Maghrib","Isya","Zuhur"],a:0},
{q:"Zakat fitrah wajib ditunaikan sebelum ...",opts:["Shalat Dzuhur","Shalat Jumat","Shalat Idul Fitri","Adzan Subuh"],a:2},
{q:"Puasa Ramadhan mengajarkan kita untuk bersyukur atas ...",opts:["Makanan","Nikmat Allah","Mainan","Tidur"],a:1}
];

/* ===============================
   SOAL KELAS 4 — BALIGH & HIJRAH (30)
===============================*/
const soalKelas4 = [
{q:"Baligh adalah keadaan ketika seorang anak mulai dikenai kewajiban ibadah dalam Islam, artinya anak tersebut sudah ...",opts:["Tidak perlu shalat","Tidak berpuasa","Wajib beribadah","Boleh meninggalkan ibadah"],a:2},
{q:"Tanda baligh pada laki-laki adalah ...",opts:["Mimpi basah","Menstruasi","Berjenggot","Berotot"],a:0},
{q:"Tanda baligh pada perempuan adalah ...",opts:["Mimpi basah","Menstruasi","Suara berubah","Tumbuh kumis"],a:1},
{q:"Setelah baligh, shalat 5 waktu hukumnya ...",opts:["Sunnah","Mubah","Makruh","Wajib"],a:3},
{q:"Puasa Ramadhan bagi yang sudah baligh hukumnya ...",opts:["Mubah","Makruh","Wajib","Sunnah"],a:2},
{q:"Baligh juga berarti seseorang mulai dicatat amalnya oleh malaikat ...",opts:["Jibril","Raqib dan Atid","Israfil","Mikail"],a:1},
{q:"Malaikat pencatat amal baik disebut ...",opts:["Atid","Raqib","Israfil","Ridwan"],a:1},
{q:"Malaikat pencatat amal buruk disebut ...",opts:["Raqib","Ridwan","Atid","Mikail"],a:2},
{q:"Hijrah Nabi adalah perpindahan beliau dari Makkah ke ...",opts:["Thaif","Yaman","Madinah","Mesir"],a:2},
{q:"Hijrah terjadi karena kaum Muslimin disiksa oleh kaum ...",opts:["Yahudi","Quraisy","Romawi","Nasrani"],a:1},
{q:"Hijrah Nabi menjadi awal perhitungan ...",opts:["Tahun Jawa","Tahun Hijriah","Tahun Masehi","Tahun China"],a:1},
{q:"Masjid pertama yang dibangun Nabi setelah tiba di Madinah adalah masjid ...",opts:["Masjid Quba","Masjid Nabawi","Masjidil Haram","Masjid Aqsa"],a:0},
{q:"Sahabat Nabi yang menemani saat hijrah adalah ...",opts:["Umar","Abu Bakar","Ali","Utsman"],a:1},
{q:"Kaum yang menyambut Nabi di Madinah disebut kaum ...",opts:["Muhajirin","Anshar","Kuraisy","Yahudi"],a:1},
{q:"Kaum Muhajirin adalah sahabat yang ...",opts:["Tinggal di Madinah","Hijrah dari Makkah","Penduduk Taif","Penduduk Yaman"],a:1},
{q:"Hijrah mengajarkan untuk ...",opts:["Putus asa","Sabar dan tawakal","Berbuat dosa","Berfoya-foya"],a:1},
{q:"Baligh membawa tanggung jawab baru yaitu ...",opts:["Bermain","Beribadah","Bermusuhan","Tidur"],a:1},
{q:"Menutup aurat adalah bagian dari menjaga ...",opts:["Harta","Akhlak","Tidur","Olahraga"],a:1},
{q:"Akhlak artinya ...",opts:["Tubuh","Perilaku","Kecepatan","Perhitungan"],a:1},
{q:"Laki-laki wajib menutup aurat dari pusar sampai ...",opts:["Lutut","Dada","Leher","Kaki"],a:0},
{q:"Perempuan wajib menutup aurat seluruh tubuh kecuali ...",opts:["Tangan dan wajah","Kaki dan tangan","Wajah saja","Kaki saja"],a:0},
{q:"Anak baligh wajib berbakti pada ...",opts:["Guru","Tetangga","Orang tua","Teman"],a:2},
{q:"Hijrah juga bermakna meninggalkan perbuatan buruk menuju ...",opts:["Permusuhan","Kebaikan","Maksiat","Kesombongan"],a:1},
{q:"Hijrah Nabi memperkuat persatuan umat ...",opts:["Yahudi","Nasrani","Islam","Romawi"],a:2},
{q:"Salah satu akhlak terpuji adalah ...",opts:["Berbohong","Menghina","Menolong","Mengejek"],a:2},
{q:"Salah satu akhlak tercela adalah ...",opts:["Jujur","Amanah","Sombong","Dermawan"],a:2},
{q:"Peristiwa hijrah mengajarkan umat Islam untuk tidak ...",opts:["Berdoa","Berusaha","Berputus asa","Beribadah"],a:2},
{q:"Sesudah hijrah, pusat pemerintahan Islam berada di ...",opts:["Makkah","Madinah","Thaif","Yaman"],a:1},
{q:"Hijrah mengajarkan umat Islam untuk tawakal kepada ...",opts:["Manusia","Allah","Harta","Pangkat"],a:1},
{q:"Orang yang baligh dicatat amalnya di ...",opts:["Laut","Buku catatan amal","Awan","Tanah"],a:1}
];

/* ===============================
      START QUIZ
===============================*/
function mulaiQuiz(){
    let n=inputNama.value.trim();
    let k=inputKelas.value;
    if(!n || !k){
        loginErr.style.display="block";
        loginErr.innerText="Nama & Kelas wajib!";
        return;
    }
    namaSiswa=n;
    kelasSiswa=k;
    soalAktif = (k==="3A"||k==="3B") ? soalKelas3 : soalKelas4;
    indexSoal=0;
    nilai=0;
    tampilQuiz();
}

function tampilQuiz(){
    login.classList.remove("active");
    quiz.classList.add("active");
    quizProgress.innerText=`Soal ${indexSoal+1}/${soalAktif.length}`;
    quizKelas.innerText=kelasSiswa;
    let s=soalAktif[indexSoal];
    quizTeks.innerText=s.q;
    quizOpsi.innerHTML="";
    quizNext.disabled=true;

    s.opts.forEach((o,i)=>{
        let div=document.createElement("div");
        div.className="option";
        div.innerText=o;
        div.onclick=()=>{
            document.querySelectorAll("#quizOpsi .option").forEach(x=>x.classList.remove("selected"));
            div.classList.add("selected");
            div.dataset.i=i;
            quizNext.disabled=false;
        };
        quizOpsi.appendChild(div);
    });
}

function lanjutQuiz(){
    let pilih=document.querySelector("#quizOpsi .selected");
    if(pilih && parseInt(pilih.dataset.i)===soalAktif[indexSoal].a) nilai+=10;
    indexSoal++;
    if(indexSoal<soalAktif.length) tampilQuiz();
    else selesaiQuiz();
}

function selesaiQuiz(){
    quiz.classList.remove("active");
    quizDone.classList.add("active");
    quizNamaShow.innerText = `${namaSiswa} (${kelasSiswa})`;
    quizSkor.innerText = nilai;

    // simpan db quiz + absen
    if(!db[kelasSiswa].absensi[namaSiswa]) db[kelasSiswa].absensi[namaSiswa]=[];
    db[kelasSiswa].absensi[namaSiswa].push("H");
    db[kelasSiswa].quiz.push({
        nama:namaSiswa,
        nilai,
        waktu:new Date().toLocaleString("id")
    });
    saveDB();
}

/* ===============================
      START ULANGAN (10 ACAK)
===============================*/
function mulaiUlangan(){
    let n=inputNama.value.trim();
    let k=inputKelas.value;
    if(!n || !k){
        loginErr.style.display="block";
        loginErr.innerText="Nama & Kelas wajib!";
        return;
    }
    namaSiswa=n;
    kelasSiswa=k;
    let pool=(k==="3A"||k==="3B")?soalKelas3:soalKelas4;
    soalAktif = shuffle([...pool]).slice(0,10);
    indexSoal=0;
    nilai=0;
    tampilUlangan();
}

function tampilUlangan(){
    login.classList.remove("active");
    ulangan.classList.add("active");
    ulProg.innerText=`Soal ${indexSoal+1}/${soalAktif.length}`;
    ulKelas.innerText=kelasSiswa;
    let s=soalAktif[indexSoal];
    ulTeks.innerText=s.q;
    ulOpsi.innerHTML="";
    ulNext.disabled=true;

    s.opts.forEach((o,i)=>{
        let div=document.createElement("div");
        div.className="option";
        div.innerText=o;
        div.onclick=()=>{
            document.querySelectorAll("#ulOpsi .option").forEach(x=>x.classList.remove("selected"));
            div.classList.add("selected");
            div.dataset.i=i;
            ulNext.disabled=false;
        };
        ulOpsi.appendChild(div);
    });
}

function lanjutUlangan(){
    let pilih=document.querySelector("#ulOpsi .selected");
    if(pilih && parseInt(pilih.dataset.i)===soalAktif[indexSoal].a) nilai+=10;
    indexSoal++;
    if(indexSoal<soalAktif.length) tampilUlangan();
    else selesaiUlangan();
}

function selesaiUlangan(){
    ulangan.classList.remove("active");
    ulanganDone.classList.add("active");
    ulNamaShow.innerText=`${namaSiswa} (${kelasSiswa})`;
    ulSkor.innerText=nilai;

    if(!db[kelasSiswa].absensi[namaSiswa]) db[kelasSiswa].absensi[namaSiswa]=[];
    db[kelasSiswa].absensi[namaSiswa].push("H");
    db[kelasSiswa].ulangan.push({
        nama:namaSiswa,
        nilai,
        waktu:new Date().toLocaleString("id")
    });
    saveDB();
}

/* ===============================
      ADMIN SYSTEM
===============================*/
let db=JSON.parse(localStorage.getItem("paiDB")||"{}");
let kelasList=["3A","3B","4A","4B"];

kelasList.forEach(k=>{
    if(!db[k]) db[k]={quiz:[], ulangan:[], absensi:{}};
});
saveDB();

function saveDB(){
    localStorage.setItem("paiDB",JSON.stringify(db));
}

function openAdmin(){
    let p=prompt("Password:");
    if(p!=="040698") return alert("Password salah BOS!");
    showAdminMenu();
}

function showAdminMenu(){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    admin.classList.add("active");
    adminPilihKelas.innerHTML="<h4>Pilih Kelas:</h4>";
    kelasList.forEach(k=>{
        let b=document.createElement("button");
        b.innerText="Kelas "+k;
        b.onclick=()=>tampilKelas(k);
        adminPilihKelas.appendChild(b);
    });
    adminKonten.innerHTML="";
}

function tampilKelas(k){
    let d=db[k];
    let html="<h4>Rekap Quiz</h4><table><tr><th>Nama</th><th>Nilai</th><th>Waktu</th></tr>";
    d.quiz.forEach(x=>html+=`<tr><td>${x.nama}</td><td>${x.nilai}</td><td>${x.waktu}</td></tr>`);
    html+="</table><br>";

    html+="<h4>Rekap Ulangan</h4><table><tr><th>Nama</th><th>Nilai</th><th>Waktu</th></tr>";
    d.ulangan.forEach(x=>html+=`<tr><td>${x.nama}</td><td>${x.nilai}</td><td>${x.waktu}</td></tr>`);
    html+="</table><br>";

    html+="<h4>Absensi Manual</h4>";
    html+='<select id="absNama"><option value="">-- Pilih Nama --</option>';
    for(let n in d.absensi) html+=`<option>${n}</option>`;
    html+='</select>';

    html+=`
    <button onclick="markAbs('${k}','H')">Hadir</button>
    <button onclick="markAbs('${k}','I')">Izin</button>
    <button onclick="markAbs('${k}','S')">Sakit</button>
    <button onclick="markAbs('${k}','A')">Alfa</button><br><br>
    `;

    html+="<table><tr><th>Nama</th><th>Absensi</th></tr>";
    for(let n in d.absensi) html+=`<tr><td>${n}</td><td>${d.absensi[n].join(", ")}</td></tr>`;
    html+="</table>";

    adminKonten.innerHTML=html;
}

function markAbs(k,mode){
    let n=document.getElementById("absNama").value;
    if(!n) return alert("Pilih nama BOS!");
    db[k].absensi[n].push(mode);
    saveDB();
    tampilKelas(k);
}

/* ===============================
      SISTEM MUSIK
===============================*/
function toggleMusik(){
    let m=document.getElementById("bgMusic");
    if(m.paused) m.play(); else m.pause();
}

/* ===============================
      RESET DATA
===============================*/
function resetData(){
    if(!confirm("Reset semua data?")) return;
    localStorage.removeItem("paiDB");
    location.reload();
}

/* ===============================
      KEMBALI KE LOGIN
===============================*/
function gotoLogin(){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    login.classList.add("active");
}
</script>
</html>
